<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <title>duGordo - Pedido</title>

    <!-- CSS global -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <script>
        let tamanhoSelecionado = null;
        let saboresSelecionados = [];

        const limites = {
            "M√©dia": 1,
            "Grande": 2,
            "Fam√≠lia": 4
        };

        function selecionarTamanho(card, tamanho) {
            document.querySelectorAll('.opcao-tamanho')
                .forEach(c => c.classList.remove('selecionado'));

            card.classList.add('selecionado');
            tamanhoSelecionado = tamanho;

            // Reset sabores ao mudar tamanho
            saboresSelecionados = [];
            document.querySelectorAll('.pizza-card').forEach(c => {
                c.classList.remove('selecionado');
                c.querySelector("input[type=checkbox]").checked = false;
            });

            document.getElementById("input-tamanho").value = tamanho;

            atualizarMensagem();
            validarBotaoFinalizar();
        }

        function selecionarSabor(card, sabor) {
            if (!tamanhoSelecionado) {
                alert("Selecione primeiro o tamanho da pizza.");
                return;
            }

            const checkbox = card.querySelector("input[type=checkbox]");
            const limite = limites[tamanhoSelecionado];

            const jaSelecionado = checkbox.checked;

            if (!jaSelecionado && saboresSelecionados.length >= limite) {
                alert(`Este tamanho permite no m√°ximo ${limite} sabor(es).`);
                return;
            }

            if (jaSelecionado) {
                checkbox.checked = false;
                card.classList.remove("selecionado");
                saboresSelecionados = saboresSelecionados.filter(s => s !== sabor);
            } else {
                checkbox.checked = true;
                card.classList.add("selecionado");
                saboresSelecionados.push(sabor);
            }

            atualizarMensagem();
            validarBotaoFinalizar();
        }

        function atualizarMensagem() {
            const texto = tamanhoSelecionado 
                ? `${saboresSelecionados.length} selecionado(s) / limite: ${limites[tamanhoSelecionado]}`
                : "";
            document.getElementById("mensagem-limite").innerText = texto;
        }

        function validarBotaoFinalizar() {
            const botao = document.getElementById("botao-finalizar");
            botao.disabled = !(tamanhoSelecionado && saboresSelecionados.length > 0);
        }
    </script>

</head>
<body>

<header>
    <h1>Monte seu Pedido</h1>
    <nav><a href="/">In√≠cio</a></nav>
</header>

<main>

<form action="/finalizar_pedido" method="POST">

    <!-- üîµ SE√á√ÉO 1 ‚Äî TAMANHOS -->
    <h2>Qual TAMANHO de sua fome?</h2>

    <input type="hidden" name="tamanho" id="input-tamanho">

    <div class="grid-tamanhos">

        <div class="opcao-tamanho" onclick="selecionarTamanho(this, 'M√©dia')">
            <h3>M√©dia</h3>
            <p>6 peda√ßos</p>
            <p><strong>R$ 30,00</strong></p>
            <p class="info-limite">1 sabor</p>
        </div>

        <div class="opcao-tamanho" onclick="selecionarTamanho(this, 'Grande')">
            <h3>Grande</h3>
            <p>8 peda√ßos</p>
            <p><strong>R$ 45,00</strong></p>
            <p class="info-limite">2 sabores</p>
        </div>

        <div class="opcao-tamanho" onclick="selecionarTamanho(this, 'Fam√≠lia')">
            <h3>Fam√≠lia</h3>
            <p>12 peda√ßos</p>
            <p><strong>R$ 55,00</strong></p>
            <p class="info-limite">4 sabores</p>
        </div>
    </div>

    <!-- üîµ SE√á√ÉO 2 ‚Äî SABORES -->
    <h2 style="margin-top: 50px;">Escolha os Sabores</h2>

    <p id="mensagem-limite" class="mensagem"></p>

    <div class="grid-cardapio">
        {% for pizza in pizzas %}
        <div class="pizza-card" onclick="selecionarSabor(this, '{{ pizza.nome }}')">

            <img src="{{ url_for('static', filename='img/' + pizza.img_file) }}">

            <h3>{{ pizza.nome }}</h3>
            <p>{{ pizza.descricao }}</p>

            <input type="checkbox" name="sabores" value="{{ pizza.nome }}" style="display:none;">
        </div>
        {% endfor %}
    </div>

    <button type="submit" id="botao-finalizar" class="botao" disabled>
        Finalizar Pedido
    </button>

</form>

</main>
</body>
</html>
